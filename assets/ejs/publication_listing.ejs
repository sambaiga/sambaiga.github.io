```{=html}
<!-- assets/ejs/publication_listing.ejs -->
<% 
  // ====================================================
  // GET PAGE SIZE FROM ITEM METADATA (From YAML config)
  // ====================================================
  let itemsPerPage = 8; // Default fallback for publications
  
  if (items && items.length > 0) {
    // Get page-size from the first item's frontmatter metadata
    itemsPerPage = items[0]['page-size'] || 8;
  }
%>

<div class="publications-listing">
  <header class="publications-header">
    <% if (typeof title !== 'undefined') { %>
      <h1 class="publications-title"><%= title %></h1>
    <% } %>

    <% if (typeof description !== 'undefined') { %>
      <p class="publications-description"><%= description %></p>
    <% } %>
    
    <!-- Quarto: Add filters if categories exist -->
    <% if (typeof allCategories !== 'undefined' && allCategories.length > 0) { %>
      <div class="publications-filters">
        <button class="filter-btn active" data-filter="all">All Publications</button>
        <% allCategories.forEach(cat => { %>
          <button class="filter-btn" data-filter="<%= cat %>"><%= cat %></button>
        <% }) %>
      </div>
    <% } %>
  </header>

  <!-- Publications Container - Single column -->
  <div class="publications-single-column">
    <% if (!items || items.length === 0) { %>
      <div class="no-publications">
        <i class="bi bi-journal-x"></i>
        <h3>No publications found</h3>
        <p>Check back soon for new research.</p>
      </div>
    <% } else { %>

      <% 
        // Helper function to generate consistent color from any string
        function stringToColor(str) {
          if (!str) return { color: '#6c757d', bg: '#f8f9fa', border: '#dee2e6' };
          
          let hash = 0;
          for (let i = 0; i < str.length; i++) {
            hash = str.charCodeAt(i) + ((hash << 5) - hash);
          }
          
          // Generate HSL color with fixed saturation and lightness for consistency
          const h = Math.abs(hash) % 360;
          
          // Return different color variations for different uses
          return {
            color: `hsl(${h}, 70%, 45%)`,
            bg: `hsla(${h}, 70%, 45%, 0.1)`,
            border: `hsla(${h}, 70%, 45%, 0.2)`,
            darkColor: `hsl(${h}, 60%, 65%)`,
            darkBg: `hsla(${h}, 60%, 65%, 0.15)`,
            darkBorder: `hsla(${h}, 60%, 65%, 0.25)`
          };
        }
      %>

      <% items.forEach((publication, index) => { %>
        <article class="publication-card-single <%= publication.featured ? 'featured-publication' : '' %>" 
                 data-categories="<%= publication.categories ? publication.categories.join(' ') : '' %>"
                 <% if (index >= itemsPerPage) { %>style="display: none;"<% } %>>
          
          <!-- Featured badge -->
          <% if (publication.featured) { %>
            <div class="featured-badge">
              <i class="bi bi-star-fill"></i> Featured
            </div>
          <% } %>

          <!-- Content Container with integrated left sidebar -->
          <div class="publication-content-single">
            <!-- Left: Combined Meta & Thumbnail Sidebar -->
            <div class="publication-meta-side">
              <!-- Integrated thumbnail -->
              <% if (publication.image || publication.thumbnail) { %>
                <div class="publication-thumbnail-integrated">
                  <a href="<%= publication.path || '#' %>" class="thumbnail-link" aria-label="View <%= publication.title %>">
                    <img
                      src="<%= publication.image || publication.thumbnail %>"
                      alt="<%= publication.title %>"
                      loading="lazy"
                      onerror="this.src='../../images/default/arts.jpg'; this.onerror=null;"
                    />
                  </a>
                </div>
              <% } %>

              <!-- Year and type below thumbnail -->
              <% if (publication.date) { %>
                <div>
                  <% 
                  let dateObj;
                  try {
                    dateObj = new Date(publication.date);
                  } catch(e) {
                    dateObj = new Date();
                  }
                  %>
                   <!--  <div class="publication-year"><%= dateObj.getFullYear() %></div>  -->
                  <div class="publication-type">
                    <% if (publication.journal) { %>
                      <span class="publication-type-icon">
                        <i class="bi bi-journal-text"></i>
                      </span>
                      Journal
                    <% } else if (publication.conference) { %>
                      <span class="publication-type-icon">
                        <i class="bi bi-mic"></i>
                      </span>
                      Conference
                    <% } else { %>
                      <span class="publication-type-icon">
                        <i class="bi bi-file-earmark-text"></i>
                      </span>
                      Publication
                    <% } %> <%= dateObj.getFullYear() %>
                  </div>
                </div>
              <% } %>
              
              <!-- Status indicator -->
              <% if (publication.status && typeof publication.status === 'string') { %>
                <div class="publication-status-indicator status-<%= publication.status.toLowerCase() %>">
                  <i class="bi bi-circle-fill"></i> <%= publication.status %>
                </div>
              <% } %>
            </div>

            <!-- Right: Main content -->
            <div class="publication-main-content">
              <!-- Authors -->
              <% if (publication.authors) { %>
                <div class="publication-authors">
                  <i class="bi bi-people" style="color: <%= publication.authors && typeof publication.authors === 'string' && publication.authors.includes('Anthony Faustine') ? '#20c997' : '#6c757d' %>;"></i>
                  <span><%= publication.authors %></span>
                </div>
              <% } %>

              <!-- Title -->
              <h2 class="publication-title-single">
                <a href="<%= publication.path || '#' %>">
                  <%= publication.title || (publication['pub-info'] ? publication['pub-info'].reference : '') || 'Untitled Publication' %>
                </a>
              </h2>

              <!-- Journal/Conference -->
              <% if (publication.journal || publication.conference) { %>
                <div class="publication-venue">
                  <% if (publication.journal) { %>
                    <i class="bi bi-book" style="color: #0dcaf0;"></i>
                    <span>
                      <%= publication.journal.title || publication.journal.name || publication.journal %>
                      <% if (publication.journal.volume && publication.journal.number) { %>
                        , Vol. <%= publication.journal.volume %>, No. <%= publication.journal.number %>
                      <% } %>
                      <% if (publication.journal.pages) { %>
                        , pp. <%= publication.journal.pages %>
                      <% } %>
                    </span>
                  <% } else if (publication.conference) { %>
                    <i class="bi bi-geo-alt" style="color: #0dcaf0;"></i>
                    <span><%= publication.conference %></span>
                  <% } %>
                </div>
              <% } %>

              <!-- Abstract/Description with Toggle Feature -->
              <% if (publication.description || publication.abstract) { %>
                <div class="publication-abstract-single">
                  <% 
                    const abstractText = publication.abstract || publication.description;
                    const previewLength = 100;
                    const showToggle = abstractText.length > previewLength;
                    const previewText = showToggle ? 
                      abstractText.substring(0, previewLength) : 
                      abstractText;
                    const remainderText = showToggle ? 
                      abstractText.substring(previewLength) : 
                      '';
                  %>
                  
                  <div class="abstract-wrapper">
                    <p class="abstract-content">
                      <span class="abstract-preview"><%= previewText %></span>
                      <% if (showToggle) { %>
                        <span class="abstract-ellipsis">...</span>
                        <span class="abstract-remainder" style="display: none;">
                          <%= remainderText %>
                        </span>
                        <button class="abstract-read-more" aria-label="Toggle abstract">
                          <span class="read-more-text">Read more</span>
                          <span class="read-more-icon">
                            <i class="bi bi-chevron-down"></i>
                          </span>
                        </button>
                      <% } else { %>
                        <%= remainderText %>
                      <% } %>
                    </p>
                  </div>
                </div>
              <% } %>

              <!-- Categories - Dynamic color generation -->
              <% if (publication.categories && Array.isArray(publication.categories) && publication.categories.length > 0) { %>
                <div class="publication-categories-single">
                  <% publication.categories.forEach(category => { 
                    const color = stringToColor(category);
                  %>
                    <span class="publication-category-tag" 
                          data-category="<%= category.toLowerCase() %>"
                          style="color: <%= color.color %>; 
                                 background-color: <%= color.bg %>; 
                                 border-color: <%= color.border %>;"
                          data-dark-color="<%= color.darkColor %>"
                          data-dark-bg="<%= color.darkBg %>"
                          data-dark-border="<%= color.darkBorder %>">
                      <%= category %>
                    </span>
                  <% }) %>
                </div>
              <% } %>

              <!-- Links -->
              <div class="publication-footer-single">
                <div class="publication-links-single">
                  <!-- Full details link -->
                  <a href="<%= publication.path || '#' %>" class="btn btn-primary btn-sm">
                    <i class="bi bi-journal-text"></i> Full details
                  </a>
                  
                  <!-- Publication links -->
                  <% if (publication['pub-info'] && publication['pub-info'].links && Array.isArray(publication['pub-info'].links)) { %>
                    <% publication['pub-info'].links.forEach(link => { %>
                      <% if (link && link.url && link.name) { %>
                        <a href="<%= link.url %>" 
                           class="btn btn-outline-primary btn-sm"
                           <%= link.target ? 'target="' + link.target + '"' : (link.url.startsWith('http') ? 'target="_blank" rel="noopener noreferrer"' : '') %>>
                          <% if (link.icon) { %>
                            <i class="<%= link.icon.startsWith('fa-') ? 'fas ' + link.icon : 'bi bi-' + link.icon %>"></i>
                          <% } %>
                          <%= link.name %>
                        </a>
                      <% } %>
                    <% }) %>
                  <% } %>
                  
                  <!-- DOI link -->
                  <% if (publication.doi) { %>
                    <a href="https://doi.org/<%= publication.doi %>" 
                       class="btn btn-outline-secondary btn-sm" 
                       target="_blank" rel="noopener noreferrer">
                      <i class="bi bi-fingerprint"></i> DOI
                    </a>
                  <% } %>
                </div>
              </div>
            </div>
          </div>
        </article>
      <% }) %>
    <% } %>
  </div>

  <!-- CUSTOM PAGINATION -->
  <% if (items && items.length > 0) { %>
    <% 
      const totalItems = items.length;
      const totalPages = Math.ceil(totalItems / itemsPerPage);
      
      if (totalPages > 1) {
        const blogPaginationId = 'pub-pag-' + Math.random().toString(36).substr(2, 9);
        
        // Get pagination style from frontmatter if available
        const paginationStyle = items[0]['pagination-style'] || 'default';
    %>
    
    <nav class="blog-pagination pagination publications-pagination <%= paginationStyle !== 'default' ? 'pagination-' + paginationStyle : '' %>" 
         aria-label="Publication navigation" 
         id="pagination-<%= blogPaginationId %>">
      <button type="button" 
              class="pagination-item pagination-item-prev disabled" 
              disabled
              aria-label="Previous page (disabled)">
        <i class="bi bi-chevron-left"></i>
        <span class="pagination-text">Prev</span>
      </button>
      
      <div class="pagination-numbers" id="numbers-<%= blogPaginationId %>"></div>
      
      <button type="button" 
              class="pagination-item pagination-item-next"
              aria-label="Go to next page">
        <span class="pagination-text">Next</span>
        <i class="bi bi-chevron-right"></i>
      </button>
    </nav>
    
    <script>
      (function() {
        const PAGE_SIZE = <%= itemsPerPage %>;
        const TOTAL_PAGES = <%= totalPages %>;
        const PAGINATION_ID = '<%= blogPaginationId %>';
        
        const paginationNav = document.getElementById('pagination-' + PAGINATION_ID);
        const listingContainer = paginationNav.closest('.publications-listing');
        const allItems = listingContainer.querySelectorAll('.publication-card-single');
        const numbersContainer = document.getElementById('numbers-' + PAGINATION_ID);
        const prevBtn = paginationNav.querySelector('.pagination-item-prev');
        const nextBtn = paginationNav.querySelector('.pagination-item-next');
        
        // Get current page from URL hash or default to 1
        let currentPage = 1;
        const hashMatch = window.location.hash.match(/pub-page=(\d+)/);
        if (hashMatch) {
          const pageFromHash = parseInt(hashMatch[1]);
          if (pageFromHash >= 1 && pageFromHash <= TOTAL_PAGES) {
            currentPage = pageFromHash;
          }
        }
        
        function showPage(pageNumber) {
          if (pageNumber < 1 || pageNumber > TOTAL_PAGES) return;
          
          // Hide all items
          allItems.forEach(item => {
            item.style.display = 'none';
            item.setAttribute('aria-hidden', 'true');
          });
          
          // Show items for current page
          const startIndex = (pageNumber - 1) * PAGE_SIZE;
          const endIndex = Math.min(startIndex + PAGE_SIZE, allItems.length);
          
          for (let i = startIndex; i < endIndex; i++) {
            allItems[i].style.display = '';
            allItems[i].setAttribute('aria-hidden', 'false');
          }
          
          currentPage = pageNumber;
          updateButtonStates();
          updatePageNumberButtons();
          updateAriaLabels();
          
          // Update URL without reloading
          const newUrl = window.location.pathname + '#pub-page=' + currentPage;
          window.history.replaceState({}, '', newUrl);
          
          // Scroll to top of posts container for better UX
          const postsContainer = listingContainer.querySelector('.publications-single-column');
          if (postsContainer && pageNumber > 1) {
            postsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }
        }
        
        function updateButtonStates() {
          // Update disabled states and classes
          const isFirstPage = currentPage === 1;
          const isLastPage = currentPage === TOTAL_PAGES;
          
          // Previous button
          prevBtn.disabled = isFirstPage;
          if (isFirstPage) {
            prevBtn.classList.add('disabled');
          } else {
            prevBtn.classList.remove('disabled');
          }
          
          // Next button
          nextBtn.disabled = isLastPage;
          if (isLastPage) {
            nextBtn.classList.add('disabled');
          } else {
            nextBtn.classList.remove('disabled');
          }
        }
        
        function updatePageNumberButtons() {
          numbersContainer.innerHTML = '';
          
          // Always show first page
          numbersContainer.appendChild(createPageButton(1));
          
          // Add ellipsis if needed before middle pages
          if (currentPage > 3) {
            numbersContainer.appendChild(createEllipsis());
          }
          
          // Show middle pages (current page Â± 1)
          const startPage = Math.max(2, currentPage - 1);
          const endPage = Math.min(TOTAL_PAGES - 1, currentPage + 1);
          
          for (let i = startPage; i <= endPage; i++) {
            numbersContainer.appendChild(createPageButton(i));
          }
          
          // Add ellipsis if needed after middle pages
          if (currentPage < TOTAL_PAGES - 2) {
            numbersContainer.appendChild(createEllipsis());
          }
          
          // Always show last page if there is more than one page
          if (TOTAL_PAGES > 1) {
            numbersContainer.appendChild(createPageButton(TOTAL_PAGES));
          }
        }
        
        function createPageButton(pageNum) {
          const button = document.createElement('button');
          button.type = 'button';
          button.className = 'pagination-item' + (pageNum === currentPage ? ' active' : '');
          button.textContent = pageNum;
          button.setAttribute('aria-label', 'Page ' + pageNum);
          button.setAttribute('aria-current', pageNum === currentPage ? 'page' : 'false');
          
          button.onclick = (e) => {
            e.preventDefault();
            showPage(pageNum);
          };
          
          return button;
        }
        
        function createEllipsis() {
          const ellipsis = document.createElement('span');
          ellipsis.className = 'pagination-item pagination-item-ellipsis';
          ellipsis.textContent = '...';
          ellipsis.setAttribute('aria-hidden', 'true');
          return ellipsis;
        }
        
        function updateAriaLabels() {
          // Update aria-label for previous and next buttons
          prevBtn.setAttribute('aria-label', 
            currentPage === 1 ? 'Previous page (disabled)' : 'Go to previous page, page ' + (currentPage - 1));
          nextBtn.setAttribute('aria-label', 
            currentPage === TOTAL_PAGES ? 'Next page (disabled)' : 'Go to next page, page ' + (currentPage + 1));
          
          // Update active page indicator
          const activeButton = numbersContainer.querySelector('.pagination-item.active');
          if (activeButton) {
            activeButton.setAttribute('aria-current', 'page');
          }
        }
        
        // Event listeners
        prevBtn.onclick = (e) => {
          e.preventDefault();
          if (currentPage > 1) showPage(currentPage - 1);
        };
        
        nextBtn.onclick = (e) => {
          e.preventDefault();
          if (currentPage < TOTAL_PAGES) showPage(currentPage + 1);
        };
        
        // Keyboard navigation
        paginationNav.addEventListener('keydown', (e) => {
          // Only handle if focus is within pagination
          if (!paginationNav.contains(document.activeElement)) return;
          
          switch(e.key) {
            case 'ArrowLeft':
              e.preventDefault();
              if (currentPage > 1) showPage(currentPage - 1);
              break;
            case 'ArrowRight':
              e.preventDefault();
              if (currentPage < TOTAL_PAGES) showPage(currentPage + 1);
              break;
            case 'Home':
              e.preventDefault();
              showPage(1);
              break;
            case 'End':
              e.preventDefault();
              showPage(TOTAL_PAGES);
              break;
            case 'Enter':
            case ' ':
              // Let default button behavior handle clicks
              break;
          }
        });
        
        // Initialize
        showPage(currentPage);
        
        // Add abstract toggle functionality
        document.querySelectorAll('.abstract-read-more').forEach(button => {
          button.addEventListener('click', function(e) {
            e.preventDefault();
            const wrapper = this.closest('.abstract-content');
            wrapper.classList.toggle('expanded');
            
            if (wrapper.classList.contains('expanded')) {
              this.querySelector('.read-more-text').textContent = 'Read less';
              this.querySelector('.read-more-icon i').className = 'bi bi-chevron-up';
            } else {
              this.querySelector('.read-more-text').textContent = 'Read more';
              this.querySelector('.read-more-icon i').className = 'bi bi-chevron-down';
            }
          });
        });
      })();
    </script>
    
    <% } // End if (totalPages > 1) %>
  <% } // End if (items && items.length > 0) %>
</div>
```
